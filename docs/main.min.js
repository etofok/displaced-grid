const FILE_URL="https://github.com/etofok/Displaced-Grid-for-Warcraft-III/archive/refs/heads/main.zip";function handleDownload(e){const t=document.createElement("a");t.href=FILE_URL,t.setAttribute("download",""),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function toggleQuestion(e){const t=e.nextElementSibling;t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show")}document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;switch(t.dataset.action){case"download-app":handleDownload(t.dataset.id);break;case"toggle-question":toggleQuestion(t);break;case"toggle-donate":document.dispatchEvent(new CustomEvent("request:toggle-donate"));break;case"scroll-top":window.scrollTo({top:0,behavior:"smooth"})}}),document.addEventListener("mouseover",e=>{const t=e.target.closest("[data-action]");if(!t)return;if("toggle-donate"===t.dataset.action)document.dispatchEvent(new CustomEvent("request:load-donate"))}),document.addEventListener("keydown",e=>{if(["placeholder-gallery","placeholder-modules"].includes(activeSectionId)&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){e.preventDefault();const t="ArrowRight"===e.key?1:-1;"placeholder-gallery"===activeSectionId?changeImage(t):"placeholder-modules"===activeSectionId&&changeModule(t)}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".navbar");function t(){window.scrollY>10?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t),t()}),initLazyLoader();let activeSectionId=null;async function initLazyLoader(){const e=document.querySelectorAll(".lazy");const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(!async function(e){if(!e.dataset.loaded&&!e.dataset.loading){e.dataset.loading="true";try{const t=await fetch(`${e.dataset.src}.html`),o=await t.text(),n=document.createRange();n.setStart(e,0);const a=n.createContextualFragment(o);e.innerHTML="",e.appendChild(a),requestAnimationFrame(()=>{e.dataset.loaded="true"}),e.dataset.loaded="true",e.classList.add("loaded")}catch(e){console.error("Fetch Error:",e)}finally{delete e.dataset.loading}}}(e.target),t.unobserve(e.target))})},{rootMargin:"200px 0px",threshold:.01}),o=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(activeSectionId=e.target.id,console.log(`Keyboard Focus: ${activeSectionId}`))})},{threshold:.6});e.forEach(e=>{t.observe(e),o.observe(e)})}let isFetching=!1;async function ensurePanelLoaded(){const e=document.getElementById("placeholder-panel-donate");if(e&&!isFetching){isFetching=!0;try{const t=await fetch("html/components/panel-donate.html");if(!t.ok)throw new Error(t.status);const o=await t.text(),n=document.createElement("div");n.innerHTML=o,e.replaceWith(...n.childNodes)}catch(e){console.error("Drop failed:",e)}finally{isFetching=!1}}}function toggleDonatePanel(){const e=document.getElementById("donateOverlay");if(!e)return;const t=e.classList.toggle("show");document.body.style.overflow=t?"hidden":"",t?history.pushState({panelOpen:!0,scrollPos:window.scrollY},"","#donate"):"#donate"===window.location.hash&&history.back()}window.addEventListener("popstate",e=>{const t=document.getElementById("donateOverlay");t&&t.classList.contains("show")&&(t.classList.remove("show"),document.body.style.overflow="")}),document.addEventListener("keydown",e=>{if("Escape"===e.key){document.getElementById("donateOverlay").classList.contains("show")&&(console.log("Panel is open, closing panel and blocking Tooltip."),toggleDonatePanel(),e.stopImmediatePropagation(),e.preventDefault())}},!0),document.addEventListener("request:load-donate",ensurePanelLoaded),document.addEventListener("request:toggle-donate",toggleDonatePanel);